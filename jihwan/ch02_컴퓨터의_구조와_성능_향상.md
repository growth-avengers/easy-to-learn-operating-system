# 2. 컴퓨터의 구조와 성능 향상

## 01. 컴퓨터의 기본 구성

### 1. 하드웨어의 구성
컴퓨터는 중앙처리장치(`CPU`), 메인메모리, 입력장치, 출력장치, 저장장치로 구성되어 있다.

### CPU와 메모리
- CPU는 명령어를 해석하고 실행하는 장치이다.
- 메모리는 작업에 필요한 프로그램과 데이터를 저장하는 장소이다.

### 입출력장치
- 입력장치는 외부의 데이터를 컴퓨터에 입력하는 장치이다.
- 출력장치는 컴퓨터에서 처리한 결과를 사용자가 원하는 형태로 출력하는 장치이다.

### 저장장치
- 저장장치는 메모리보다 느리지만 저령하고 용량이 크며, 전원 온 오프와 상관없이 데이터를 저장한다.

### 메인보드
- 메인보드는 CPU와 메모리 등 다양한 부품을 연결하는 커다란 판이다.

### 2. 폰노이만 구조
오늘날은 폰노이만 구조를 따른다.
- 폰노이만 구조는 CPU, 메모리, 입출력장치, 저장장치가 버스로 연결되어 있는 구조다.
- 폰노이만은 메모리를 이용하여 프로그래밍 가능한 컴퓨터 구조, 하드웨어는 그대로 둔 채 작업을 프로그램만 교체하여 메모리에 올리는 방식을 채택했다.
- 폰노이만 구조는 '모든 프로그램은 메모리에 올라와야 실행할 수 있다.'
- 저장장치에 있는 프로그램을 실행하려면 프로그램이 메모리에 올라와야 하며, 운영체제도 프로그램이기 때문에 메모리에 올라와야 실행이 가능하다.

### 3. 하드웨어 사양 관련 용어
- 클록
	- 클록(`Clock`)은 CPU의 속도와 관련된 단위이다.
- 헤르츠
	- 헤르츠(`Hz`)는 클록틱이 발생하는 속도를 나타내는 단위이다.
- 시스템 버스와 CPU 내부 버스
	- 시스템 버스(`System bus`)는 메모리 주변장치를 연결하는 버스라고 한다.
	- CPU 내부 버스에 장치를 연결하는 버스로 BSB(`Back Side Bus`)라고 한다.
	- CPU는 CPU 내부 버스의 속도로 작동하고 메모리는 시스템 버스의 속도로 작동하기 때문에 속도 차이가 생겨 지연 문제가 생긴다.

# 02. CPU와 메모리

## 1. CPU의 구성과 동작

### CPU의 기본 구성
CPU는 명령어를 해석하여 실행하는 장치
- 산술논리 연산장치
	- CPU에서 데이터를 연산하는 장치가 산술논리, 연산장치(`Arithmetic and Logic Unit, ALU`)
- 제어장치
	- CPU에서 작업을 지시하는 부분을 제어장치(`control unit`)
- 레지스터
	- CPU 내에 데이터를 임시로 보관하는 곳을 레지스터(`register`)

### CPU의 명령어 처리 과정
1. 코드 작성를 작성한다.
2. 코드를 실행하려면 컴파일러를 이용하여 기계어로 바꾼다.
3. CPU가 연산을 하려면 CPU로 가져와 임시로 보관해야 하는데 그 장소가 레지스터이다.
4. 제어장치는 명령어를 해석하여 제어 신호를 보내고 CPU 내의 데이터 흐름을 조절하는 역활을 한다.

### 레지스터의 종류
CPU는 필요한 데이터를 메모리에서 가져와 레지스터에 저장하고 산술논리 연산장치를 이용하여 연산을 한 후, 그 결과를 다시 레지스터에 저장했다가 메모리로 옮긴다.

- 데이터 레지스터 : 데이터 레지스터는 메모리에서 가져온 데이터를 임시로 보관할 때 사용한다.
- 주소 레지스터: 데이터 또는 명령어가 저장된 메모리의 주소는 주소 레지스터에 저장된다.
- 프로그램 카운터 : CPU는 다음에 어떤 명령어를 처리해야 할지 알아야 한다.
- 명령어 레지터 : 명령어 레지스터는 현재 실행 중인 명령어를 저장한다.
- 메모리 주소 레지스터 : 메모리 주소 레지스터는 메모리에서 데이터를 가져오거나 반대로 메모리로 데이터를 보낼 때 주소를 지정하기 위해 사용한다.
- 메모리 버퍼 레지스터 : 메모리 버퍼 레지스터는 메모리에서 가져온 데이터나 메모리로 옮겨 갈 데이터를 임시로 저장한다.

### 버스의 종류
버스에는 다음 작업을 지시하는 제어 신호, 메모리의 위치 정보를 알려주는 주소, 처리할 데이터가 오고 가며 각각 제어 버스, 주소 버스, 데이터 버시를 실린다.
- **제어 버스**
제어 버스에서는 다음에 어떤 작업을 할지 지시하는 제어 신호가 오고 간다.
- **주소 버스**
주소 버스에서는 메모리의 데이터를 읽거나 쓸 때 어느 위치에서 작업할 것인지를 알려주는 위치 정보가 오고 간다.
- **데이터 버스**
제어 버스가 다음에 어떤 작업을 할지 신호를 보내고 주소 버스가 위치 정보를 전달하며 데이터 버스에 실려 목적지까지 이동한다.

### 메모리의 종류와 부팅
모든 프로그램은 메모리에 올라와야 실행될 수 있다. 메모리에는 실행에 필요한 프로그램과 데이터가 존재하며, CPU와 협업하여 작업이 이루어진다.

### 메모리의 종류
메모리는 읽거나 쓸 수 있는 램과 읽기만 가능한 룸으로 구분된다.

- 휘발성 메모리
휘발성 메모리에는 DRAM과 SRAM이 있다.
- 비휘발성 메모리
비휘발성 메모리에는 플래시 메모리, FRAM, PRAM등이 있다.

### 메모리 보호
일괄 작업 시스템에서는 메모리가 운영체제 영역과 사용자 영역으로 구분된다.

### 부팅
응용 프로그램은 운영체제가 메모리에 올라서 실행하는데 그렇다면 운영체제도 CPU에 의해 실행되는 프로그램이기 때문에 다영히 메모리에 올라와야 한다. 따라서 컴퓨터를 켰을 때 누군가가 운영체제를 메모리에 올려서 실행해야 한다.

# 03. 컴퓨터 성능 향상 기술
## 1. 버퍼
### 버퍼의 개념
- 버퍼(`buffer`)는 속도에 차이가 있는 두 장치 사이에서 그 차이를 완화하는 역활을 한다.
- 일정량의 데이터를 모아 한꺼번에 전송하면 적은 노력으로도 많은 양의 데이터를 옮길 수 있다.
- 일정량의 데이터를 모아 옮김으로써 속도의 차이를 완화하는 장치
- 같은 사양의 하드디스크라면 버퍼의 용량이 큰 것이 더 빠르다.

### 스풀
- 스풀은 CPU와 입출력장치가 독립적으로 동작하도록 고안된 소프트웨어적인 버퍼
- 스플러는 일종의 버퍼이지만 기존의 버퍼와 다른 점이다.

### 캐시
- 캐시(`cache`)는 메모리와 CPU 간의 속도 차이를 완화하기 위해 메모리의 데이터를 미리 가져와 저장해두는 임시 장소이다.
- 캐시는 필요한 데이터를 모아 한꺼번에 전달하는 버퍼의 일종으로 CPU가 앞으로 사용할 것으로 예상되는 데이터를 미리 가져다 놓는다.
- 캐시에서 원하는 데이터를 찾았다면 캐시 히트(`cache hit`)라고 한다.
- 원하는 데이턱 캐시에 없으면 메모리로 가서 데이터를 찾는데 이를 캐시 미스(`cache miss`)라고 한다.
- 컴퓨터의 성능을 향상하려면 캐시 적중률이 높아야 한다.

### 즉시 쓰기와 지연 쓰기
캐시에 있는 데이터가 변경되는 경우 반영하는데 문제가 생긴다.
캐시의 변겨된 데이터를 메모리에 반영하는데  즉시 쓰기와 지연쓰기 방식이 있다.
- 즉시 쓰기
즉시 쓰기(`write through`)는 캐시에 있는 데이터가 변경되면 즉시 메모리에 반영하는 방식이다.
- 지연 쓰기
지연 쓰기(`write back`)는 캐시에 있는 데이터가 변경되면 즉시 메모리에 반영하는 것이 아니라 변경된 내용을 모아서 주기적으로 반영하는 방식이다.

### L1 캐시와 L2 캐시
- 명령어 캐시나 데이터 캐시는 CPU 레이스터에 직접 연결되기 때문에 L1 캐시라고 한다.
- 일반 캐시는 메모리와 연결되기 때문에 L2 캐시라고 한다.

### 인터럽트
CPU가 직접 입출력장치에서 데이터를 가져오거나 내보내는방식을 폴링(`polling`) 방식이라고 한다.
이 문제를 해결하기 위해서 인터럽트(`interrupt`)방식이다.
- 인터럽트 방식은 CPU의 작업과 저장장치의 데이터 이동을 독립적으로 운영함으로써 시스템의 효율을 높인다.
- 데이터의 입출력이 이루어지는 동안 CPU가 다른 작업을 할 수 있다.

### 인터럽트 방식의 동작 과정
1. CPU가 입출력 관리자에게 입출력 명령을 보낸다.
2. 입출력 관리자는 명령받은 데이터를 메모리에 가져다놓거나 메모리에 있는 데이터를 저장장치로 옮긴다.
3. 데이터 전송이 완료되면 입출력 관리자는 완료 신호를 CPU에 보낸다.

- 인터럽트는 입출력 요청, 데이터 전송, 인터럽트 발생 순으로 진행한다.

# 04. 병렬 처리
## 1.  병렬 처리의 개념
- 병렬 처리(`parallel processing`)는 동시에 여러 개의 명령을 처리하여 작업의 능률을 올리는 방식
- 여려 개의 명령을 동시에 처리하는 병렬 처리는 코어가 여러 개인 CPU는 코어가 하나인 CPU에서도 작동 가능하다.
- CPU의 사용에 비유하면 하나의 코어에 여러 개의 스레드(`thread`)를 이용한다. 이 방식을 파이프라인 기법이다.
- 여러 개의 스레드를 동시에 처리하는 방법 CPU 멀티스레드(`multi-thread`)라고 한다.

## 2. 병렬 처리 시 고려 사항
- 상호 의존성이 없어야 병렬 처리가 가능하다
	- 각 명령이 서로 독립적이고 앞의 결과가 뒤에 명령에 영향을 미치지 않아야 한다
- 각 단계의 시간을 거의 일정하게 맞춰야 병렬 처리가 원만하게 이루어진다.
	- 각 단계의 처리 시간이 들쑥날쑥하면 앞의 작업이 먼저 끝나더라도 가장 긴 시간이 걸리는 단계 병목 현상이다.
- 전체 작업 시간을 몇 단계로 나눌지 잘 따져보아야 한다.
	- 병렬 처리에서 작업을 N개로 쪼갰을 때 N을 병렬 처리의 깊이라고 한다.

## 3. 병렬 처리 기법
- 스레드를 이루는 각 단계는 CPU의 클록과 연동되어 한 클록에 한 번씩 이루어진다.
- 병렬 처리 기법은 하나의 코어에서 작업을 나누어 병렬로 처리하는 파이프라인 기법
- 슈퍼스칼라 기법은 여러 개의 코어를 사용하여 동시에 작업을 진행한다.

### 파이프라인 기법
- CPU 사양과 연관지어 보면 하나의 코어에 여러 개의 스레드를 사용한다.
- 파이프라인 기법에서는 명령어를 여러 개의 단꼐로 분할한 후, 각 단계를 동시에 처리하는 하드웨어를 독립적으로 구성한다.
- 기존 방식에서는 한 명령어를 처리하기 위해 명령어 처리 4단계를 모두 마치고 다음 명령어를 실행하지만, 파이프라인 기법에서는 명령어 처리의 단계마다 독립적으로 구성하여 각 단계가 쉬지 않고 명령어를 처리할 수 있게 한다.
- 데이터의 위험은 파이프라인의 명려어 단계를 지연하여 해결한다.
- 제어 위험은 분기 예측이나 분기 지연 방법으로 해결한다.
- 구조 위험은 해결하기 어렵다.

### 슈퍼스칼라 기법
- 슈퍼스칼라 기법은 파이프라인을 처리할 수 있는 코어를 여러 개 구성하여 복수의 명령어가 동시에 실행되도록 하는 방식이다.
- 파이프라인 기법은 동일하지만 코어를 2개 구성하여 각 단계에서 동시에 실행되는 명령어가 2개라는 점이 다르다.
- 슈퍼스칼라 기법은 처리되는 명령어가 상호 의존성 없이 독립적이어야 하며, 이를 처리도 컴파일러에서 이루어지도록 조정한다.

### 슈퍼파이프라인 기법
파이라인 기법에서 한 클록마다 하나의 명령어를 실행하지만, 슈퍼파이프라인 기법에서 파이프라인의 각 단계를 세분하여 한 클록 내에 여러 명령어를 처리할 수 있다.

### 무어의 법칙
- PC용 CPU의 경우 하나의 코어에 2개의 스레드를 사용하는 4코어 8스레드 제품이 판매된다.

### 암달의 법칙
- 이 법칙은 주변장치의 향상없이 CPU의 속도를 2GHz에서 4GHz로 늘리더라도 컴퓨터의 성능이 2개 빨라지지 않는다.