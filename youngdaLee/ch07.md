# ch07. 물리메모리 관리

## 7.1 메모리 관리의 개요

- 부팅 = HDD의 운영체제가 메모리에 올라가는 것
- 메모리는 CPU 입장에서는 느린 장치 -> 극복을 위해 CPU의 캐시를 만들어두고 메모리 일정 부분을 가져와 작업

메모리 관리 시스템(MMS. Memory Menagement System)

- 일괄처리 시스템 -> 한 번에 한 작업만 진행 / 시분할 시스템 -> 모든 응용 프로그램이 메모리에 올라와 관리가 복잡
- 프로세스와 메모리간 상충되는 요구사항을 처리

컴파일러 방식 목적

- 오류 발견
- 소스코드 최적화
  => 사용할 변수를 먼저 선언 후 코드 작성(for 최젹화)

컴파일 과정

- 소스코드 -> 컴파일러 -> 목적코드 -> 링커 -> 실행

메모리 관리 작업

- 가져오기(fetch)
- 배치(PLACEMENT)
- 재배치(replacement)

## 7.2 메모리 주소

32bit vs 64bit

- 한 번에 다룰 수 있는 크기

논리주소와 물리 주소

- 물리 주소 공간 : 하드웨어 입장에서의 주소 공간. 컴퓨터마다 크기가 다름
- 논리 주소 공간 : 사용자 입장에서 바라본 주소 공간

## 7.3 단일 프로그래밍 환경의 메모리 할당

메모리 오버레이

- 프로그램의 실제 크기가 물리메모리 보다 클 때 전체 프로그램을 메모리에 가져오는 대신 적당한 크기로 잘라 가져오는 기법
- 한정된 메모리보다 큼 프로그램을 실행할 수 있음
- 프로그램 전체가 아니라 일부만 메모리에 올라와도 실행 가능

스왑

- 스왑 영역 : 메모리가 모자라서 쫓겨난 프로세스를 모아둔 저장장치 영역
- 메모리 오버레이 : 메모리보다 큰 프로그램을 실행할 때 메모리보다 작은 모듈로 나눠 실행 -> 여기에 스왑을 이용하면 스왑 영역의 크기가 메모리 크기로 인식

## 7.4 다중 프로그래밍 환경의 메모리 할당

메모리 분할 방식

- 가변 분할 방식 : 프로세스의 크기에 따라 메모리를 나눈다
  - 장점 : 프로세스를 한 덩이로 처리하여 하나의 프로세스를 연속된 공간에 배치 가능하다
  - 단점 : 메모리 관리가 복잡하다
  - 세그멘테이션 메모리 관리 기법 -> 빈 공간의 크기가 일정하지 않기 때문에 프로세스 종료 시 단편화 발생
  - 외부 단편화 -> 해결 위해 메모리 배치 방식이나 조각모음을 사용함.
  - 매모리 배치 방식
    - 최초 배치 : 단편화를 고려하지 않는 방식.
    - 최적 배치 : 메모리 빈 공간 확인 후 크기 비슷한 곳에 프로세스 배치하는 방식
    - 최악 배치 : 빈공간 모두 확인 후 가장 큰 공간에 프로세스 배치하는 방식
  - 조각모음 : 서로 떨어져있는 빈 공간 합치는 방식. 메모리 통합.
    1. 조각모음을 하기 위해 이동할 프로세스 동작 중지
    2. 프로세스를 적당한 위치로 이동. 프로세스의 논리 주소값 변경
    3. 1,2 과정 이후 프로세스 재실행
- 고정 분할 방식 : 프로세스 크기와 상관 없이 메모리를 같은 크기로 나눈다.
  - 장점 : 메모리를 일정 크기로 나누기 때문에 메모리 관리가 편리하다
  - 단점 : 하나의 프로세스가 여러 곳으로 나뉠 수 있다. -> 프로세스가 여러 곳에 나눠지거나, 일부는 스왑영역에 있는 등으로 배치 되어도 실행에 문제 없기 때문에 현대 OS의 메모리 관리는 고정분할방식을 선택한다.
  - 페이징(paging) : 고정 분할 방식을 사용하여 물리 메모리를 나누는 방식
  - 내부 단편화 : 각 메모리 조각에 프로세스를 배치하고 공간이 남는것. 같은 크기로 나뉜 공간 내부에서 조각이 발생.
    - 조각모음 불가. 남는 공간 프로세스에 배정 불가
    - 메모리를 어떤 크기로 나눌지 신중히 결정

버디시스템

- 외부 단편화 완화 방법. 가변 분할과 고정 분할 중간 구조

1. 프로세스 크기에 맞춰 메모리를 1/2로 자르고 프로세스를 메모리에 배치
2. 나뉜 메모리의 각 구역에 프로세스 1개 들어감
3. 프로세스 종료 후 주변 빈 조각과 합쳐 하나의 큰 덩어리 생성

## 7.5 분할 컴파일과 메모리 관리

분할 컴파일

- 각각의 컴파일 결과(목적코드)를 합쳐 컴파일하는 것

변수와 메모리 할당

-

## 질문

- 메모리 오버레이와 스왑을 연관지어 설명해봅시다
- 평소에는 메모리를 거의 사용하지 않는 서버가 특정 시간대에만 메모리를 과도하게 사용하여 Out Of Memory 에러가 발생한다 가정했을 때, 현명하게 해결할 수 있는 방법은 무엇일까요?
- 내부 단편화와 외부 단편화를 비교해서 설명하고, 각각의 해결 방식에 대해 설명해봅시다.
